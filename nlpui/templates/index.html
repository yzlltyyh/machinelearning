<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½æƒ…æ„Ÿåˆ†æç³»ç»Ÿ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- æ·»åŠ  ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components/buttons.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components/cards.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components/inputs.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components/progress.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components/audio-player.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components/animations.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/layouts/header.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/layouts/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/layouts/results.css') }}">
    <style>
        .sentiment-chart {
            width: 100%;
            height: 300px;
            margin: 25px 0 10px;
            padding: 10px;
        }
        .result-emotion {
            text-align: center;
            margin: 20px 0;
            animation: bounceIn 0.6s ease-out;
        }
        
        .large-emoji {
            font-size: 4em;
            line-height: 1;
            display: inline-block;
        }
        
        @keyframes bounceIn {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            60% {
                transform: scale(1.2);
                opacity: 0.7;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .result-item .value {
            font-weight: bold;
            transition: color 0.3s ease;
        }

        :root {
            --emotion-color: #607D8B;
        }

        .audio-player {
            border: 2px solid var(--emotion-color);
            transition: border-color 0.3s ease;
            border-radius: 12px;
            overflow: hidden;
        }

        .audio-header {
            background-color: var(--emotion-color);
            transition: background-color 0.3s ease;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            padding: 12px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .emotion-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }

        .emotion-emoji {
            font-size: 1.2em;
            line-height: 1;
        }

        .audio-player[data-emotion='positive'] {
            --emotion-color: #81c784;  /* æ›´æŸ”å’Œçš„ç»¿è‰² */
        }

        .audio-player[data-emotion='negative'] {
            --emotion-color: #e57373;  /* æ›´æŸ”å’Œçš„çº¢è‰² */
        }

        .audio-player[data-emotion='neutral'] {
            --emotion-color: #90a4ae;  /* æ›´æŸ”å’Œçš„ç°è‰² */
        }

        .play-button {
            background-color: var(--emotion-color);
            border: none;
            transition: background-color 0.3s ease;
            border-radius: 50%;
        }

        .audio-progress {
            border-radius: 4px;
            overflow: hidden;
        }

        .audio-progress-bar {
            background-color: var(--emotion-color);
            transition: background-color 0.3s ease;
        }

        .volume-level {
            background-color: var(--emotion-color);
            transition: background-color 0.3s ease;
        }

        /* æ·»åŠ ç»“æœåŒºåŸŸçš„ä¸¤åˆ—å¸ƒå±€æ ·å¼ */
        .results-layout {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
            align-items: start;
            margin: 30px;
            padding: 25px;
            display: none;
        }
        
        /* æ˜¾ç¤ºç»“æœåŒºåŸŸæ—¶çš„æ ·å¼ */
        .results-layout.show {
            display: grid;
        }
        
        /* åœ¨å°å±å¹•ä¸Šåˆ‡æ¢ä¸ºå•åˆ—å¸ƒå±€ */
        @media (max-width: 768px) {
            .results-layout {
                grid-template-columns: 1fr;
                margin: 20px;
                padding: 15px;
            }
        }
        
        /* å›ºå®šéŸ³é¢‘æ’­æ”¾å™¨çš„ä½ç½® */
        .audio-section {
            position: sticky;
            top: 20px;
        }

        .audio-controls {
            padding: 15px;
            border-bottom-left-radius: 10px;
            border-bottom-right-radius: 10px;
        }

        .volume-slider {
            border-radius: 3px;
            overflow: hidden;
        }

        .audio-title {
            flex: 1;
            font-size: 0.95em;
            font-weight: 500;
        }

        /* æ·»åŠ èƒŒæ™¯è£…é¥°æ ·å¼ */
        .main-content {
            position: relative;
            z-index: 1;
        }
        
        .background-decoration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            opacity: 0.4;
        }
        
        .decoration-shape {
            position: absolute;
            border-radius: 50%;
            background: linear-gradient(45deg, #f3f4f6, #e5e7eb);
            animation: float 20s infinite ease-in-out;
        }
        
        .shape-1 {
            width: 300px;
            height: 300px;
            top: 15%;
            left: -150px;
            animation-delay: -5s;
        }
        
        .shape-2 {
            width: 200px;
            height: 200px;
            top: 60%;
            right: -100px;
            animation-delay: -2s;
        }
        
        .shape-3 {
            width: 150px;
            height: 150px;
            bottom: 10%;
            left: 15%;
            animation-delay: -8s;
        }
        
        @keyframes float {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            25% {
                transform: translateY(-20px) rotate(5deg);
            }
            75% {
                transform: translateY(20px) rotate(-5deg);
            }
        }
        
        /* ç¡®ä¿å†…å®¹åŒºåŸŸæœ‰é€‚å½“çš„é—´è·å’ŒèƒŒæ™¯ */
        .content-block, .results-layout {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 
                       0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        /* è°ƒæ•´ç»“æœå¡ç‰‡çš„æ ·å¼ */
        .result-card {
            margin-bottom: 20px;
            border-radius: 16px;
            overflow: hidden;
            background: white;
        }
        
        /* è°ƒæ•´ç»“æœå†…å®¹çš„å†…è¾¹è· */
        .result-content {
            padding: 20px;
        }

        /* åªç»™å³ä¾§éŸ³é¢‘æ’­æ”¾å™¨æ·»åŠ é˜´å½± */
        .audio-section .audio-player {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <!-- æ·»åŠ èƒŒæ™¯è£…é¥° -->
    <div class="background-decoration">
        <div class="decoration-shape shape-1"></div>
        <div class="decoration-shape shape-2"></div>
        <div class="decoration-shape shape-3"></div>
    </div>

    <!-- ä¿æŒåŸæœ‰çš„å¤´éƒ¨åŒºåŸŸ -->
    <header class="header">
        <div class="header-decoration">
            <div class="decoration-circle decoration-circle-1"></div>
            <div class="decoration-circle decoration-circle-2"></div>
        </div>
        <h1 class="header-title">æ™ºèƒ½æƒ…æ„Ÿåˆ†æ</h1>
        <p class="header-subtitle">æ¢ç´¢æ–‡å­—èƒŒåçš„æƒ…æ„Ÿä¸–ç•Œï¼Œè®©AIåŠ©ä½ æ´å¯Ÿæƒ…æ„Ÿè„‰ç»œ</p>
    </header>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <main class="main-content">
        <!-- ä¿æŒåŸæœ‰çš„è¾“å…¥åŒºåŸŸ -->
        <section class="content-block content-block-lg animate-fade-in-up">
            <div class="voice-controls">
                <div class="btn-group">
                    <button id="startVoice" class="btn btn-voice">
                        <i class="fas fa-microphone"></i>
                        å¼€å§‹è¯­éŸ³è¾“å…¥
                    </button>
                    <button id="stopVoice" class="btn btn-voice" disabled>
                        <i class="fas fa-stop-circle"></i>
                        åœæ­¢è¯­éŸ³è¾“å…¥
                    </button>
                </div>
                <div class="status-badge">ç­‰å¾…è¾“å…¥</div>
            </div>

            <div class="input-wrapper mt-6">
                <textarea id="inputText" 
                         class="input-field textarea"
                         placeholder="è¯·è¾“å…¥æˆ–è¯´å‡ºè¦åˆ†æçš„æ–‡æœ¬..."></textarea>
            </div>

            <div class="btn-group mt-6">
                <button id="analyzeBtn" class="btn btn-primary">
                    <i class="fas fa-search"></i>
                    åˆ†ææƒ…æ„Ÿ
                </button>
                <button id="generateTTS" class="btn btn-secondary">
                    <i class="fas fa-volume-up"></i>
                    ç”Ÿæˆè¯­éŸ³
                </button>
            </div>
        </section>

        <!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
        <div id="loadingIndicator" class="loading-section d-none">
            <div class="loading-spinner"></div>
            <p class="loading-text">æ­£åœ¨åˆ†æï¼Œè¯·ç¨å€™...</p>
        </div>

        <!-- ä¿®æ”¹ç»“æœæ˜¾ç¤ºåŒºåŸŸçš„ç»“æ„ -->
        <div class="results-layout">
            <section id="results" class="results-container">
                <!-- é¥¼å›¾å°†é€šè¿‡JavaScriptåŠ¨æ€æ’å…¥åˆ°è¿™é‡Œ -->
            </section>

            <section class="audio-section" style="display: none;">
                <div class="audio-player">
                    <div class="audio-header">
                        <span class="emotion-indicator">
                            <i class="fas fa-headphones"></i>
                            <span class="emotion-emoji"></span>
                        </span>
                        <span class="audio-title">è¯­éŸ³æ’­æ”¾</span>
                    </div>
                    <div class="audio-controls">
                        <button class="play-button">
                            <i class="fas fa-play"></i>
                        </button>
                        <div class="audio-progress">
                            <div class="audio-progress-bar"></div>
                            <div class="audio-progress-handle"></div>
                        </div>
                        <div class="audio-time">
                            <span class="current-time">0:00</span>
                            <span>/</span>
                            <span class="duration">0:00</span>
                        </div>
                        <div class="volume-control">
                            <i class="fas fa-volume-up"></i>
                            <div class="volume-slider">
                                <div class="volume-level" style="width: 100%"></div>
                            </div>
                        </div>
                    </div>
                    <audio id="ttsAudio">
                        <source src="" type="audio/wav">
                        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
                    </audio>
                </div>
            </section>
        </div>
    </main>

    <!-- ä¿®æ”¹JavaScriptéƒ¨åˆ† -->
    <script>
        // è¯­éŸ³è¾“å…¥ç›¸å…³å‡½æ•°
        function initVoiceInput() {
            const startBtn = document.getElementById('startVoice');
            const stopBtn = document.getElementById('stopVoice');
            const statusBadge = document.querySelector('.status-badge');
            const textArea = document.getElementById('inputText');

            if ('webkitSpeechRecognition' in window) {
                const recognition = new webkitSpeechRecognition();
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.lang = 'zh-CN';

                startBtn.addEventListener('click', () => {
                    recognition.start();
                    startBtn.disabled = true;
                    stopBtn.disabled = false;
                    statusBadge.textContent = 'æ­£åœ¨å½•éŸ³...';
                });

                stopBtn.addEventListener('click', () => {
                    recognition.stop();
                    startBtn.disabled = false;
                    stopBtn.disabled = true;
                    statusBadge.textContent = 'ç­‰å¾…è¾“å…¥';
                });

                recognition.onresult = (event) => {
                    let finalTranscript = '';
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        if (event.results[i].isFinal) {
                            finalTranscript += event.results[i][0].transcript;
                        }
                    }
                    if (finalTranscript) {
                        textArea.value = finalTranscript;
                    }
                };
            } else {
                startBtn.disabled = true;
                stopBtn.disabled = true;
                statusBadge.textContent = 'æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¾“å…¥';
            }
        }

        // åˆå§‹åŒ–è¯­éŸ³è¾“å…¥
        initVoiceInput();

        // åˆå§‹åŒ–é¥¼å›¾
        let myChart = null;

        function createSentimentChart(container) {
            if (!myChart) {
                myChart = echarts.init(container);
            }
            return myChart;
        }

        function updateChart(probabilities) {
            const chartContainer = document.querySelector('#sentiment-chart');
            if (!chartContainer) {
                return;
            }

            const chart = createSentimentChart(chartContainer);
            const option = {
                title: {
                    text: 'æƒ…æ„Ÿæ¦‚ç‡åˆ†å¸ƒ',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'item',
                    formatter: '{b}: {c}%'
                },
                legend: {
                    orient: 'horizontal',
                    bottom: 'bottom'
                },
                series: [
                    {
                        type: 'pie',
                        radius: '50%',
                        data: [
                            { value: (probabilities[0] * 100).toFixed(1), name: 'ç§¯æ' },
                            { value: (probabilities[1] * 100).toFixed(1), name: 'ä¸­æ€§' },
                            { value: (probabilities[2] * 100).toFixed(1), name: 'æ¶ˆæ' }
                        ],
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }
                ]
            };
            chart.setOption(option);
        }

        // åˆ†ææƒ…æ„Ÿçš„å‡½æ•°
        async function analyzeSentiment() {
            const text = document.querySelector('#inputText').value;
            if (!text) return;

            // æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
            document.getElementById('loadingIndicator').classList.remove('d-none');

            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ text })
                });
                const data = await response.json();
                // æ˜¾ç¤ºç»“æœåŒºåŸŸ
                document.querySelector('.results-layout').classList.add('show');
                updateResults(data);
            } catch (error) {
                console.error('Error:', error);
            } finally {
                // éšè—åŠ è½½æŒ‡ç¤ºå™¨
                document.getElementById('loadingIndicator').classList.add('d-none');
            }
        }

        // ä¿®æ”¹ç”Ÿæˆè¯­éŸ³çš„å‡½æ•°
        async function generateTTS() {
            const text = document.querySelector('#inputText').value;
            if (!text) return;

            const sentimentElement = document.querySelector('.result-content .value');
            let sentiment = 'neutral';
            let emotionEmoji = 'ğŸ˜'; // é»˜è®¤è¡¨æƒ…
            let emotionColor = '#90a4ae'; // é»˜è®¤ä½¿ç”¨æŸ”å’Œçš„ç°è‰²

            if (sentimentElement) {
                const sentimentText = sentimentElement.textContent;
                if (sentimentText.includes('ç§¯æ') || sentimentText.includes('æ­£é¢')) {
                    sentiment = 'positive';
                    emotionEmoji = 'ğŸ˜Š';
                    emotionColor = '#81c784';
                } else if (sentimentText.includes('æ¶ˆæ') || sentimentText.includes('è´Ÿé¢')) {
                    sentiment = 'negative';
                    emotionEmoji = 'ğŸ˜”';
                    emotionColor = '#e57373';
                }
            }

            try {
                const response = await fetch(`/api/tts?text=${encodeURIComponent(text)}&sentiment=${sentiment}`);
                if (!response.ok) throw new Error('TTS generation failed');

                const blob = await response.blob();
                const audioUrl = URL.createObjectURL(blob);
                
                // ä¿®æ”¹æ˜¾ç¤ºéŸ³é¢‘æ’­æ”¾åŒºåŸŸçš„æ–¹å¼
                const audioSection = document.querySelector('.audio-section');
                audioSection.style.display = 'flex';  // ä½¿ç”¨flexå¸ƒå±€ä½¿å†…å®¹å±…ä¸­
                audioSection.style.flexDirection = 'column';
                
                // æ›´æ–°éŸ³é¢‘æºå’Œæ ·å¼
                const audioPlayer = document.querySelector('#ttsAudio');
                const audioPlayerElement = document.querySelector('.audio-player');
                const emotionEmojiElement = document.querySelector('.emotion-emoji');
                
                if (audioPlayer) {
                    audioPlayer.src = audioUrl;
                    
                    // æ›´æ–°æƒ…æ„Ÿæ ·å¼
                    audioPlayerElement.setAttribute('data-emotion', sentiment);
                    emotionEmojiElement.textContent = emotionEmoji;
                    
                    // æ›´æ–°é¢œè‰²æ ·å¼
                    document.documentElement.style.setProperty('--emotion-color', emotionColor);
                    
                    // åˆå§‹åŒ–éŸ³é¢‘æ’­æ”¾å™¨æ§ä»¶
                    initAudioPlayer();
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // æ·»åŠ éŸ³é¢‘æ’­æ”¾å™¨åˆå§‹åŒ–å‡½æ•°
        function initAudioPlayer() {
            const audio = document.querySelector('#ttsAudio');
            const playButton = document.querySelector('.play-button');
            const progressBar = document.querySelector('.audio-progress-bar');
            const progressHandle = document.querySelector('.audio-progress-handle');
            const currentTimeSpan = document.querySelector('.current-time');
            const durationSpan = document.querySelector('.duration');
            const volumeControl = document.querySelector('.volume-control');
            const volumeLevel = document.querySelector('.volume-level');

            // æ’­æ”¾/æš‚åœæŒ‰é’®ç‚¹å‡»äº‹ä»¶
            playButton.onclick = function() {
                if (audio.paused) {
                    audio.play();
                    playButton.innerHTML = '<i class="fas fa-pause"></i>';
                } else {
                    audio.pause();
                    playButton.innerHTML = '<i class="fas fa-play"></i>';
                }
            };

            // æ›´æ–°è¿›åº¦æ¡
            audio.ontimeupdate = function() {
                const percent = (audio.currentTime / audio.duration) * 100;
                progressBar.style.width = percent + '%';
                progressHandle.style.left = percent + '%';
                currentTimeSpan.textContent = formatTime(audio.currentTime);
            };

            // éŸ³é¢‘åŠ è½½å®Œæˆåæ˜¾ç¤ºæ€»æ—¶é•¿
            audio.onloadedmetadata = function() {
                durationSpan.textContent = formatTime(audio.duration);
            };

            // è¿›åº¦æ¡ç‚¹å‡»äº‹ä»¶
            const progress = document.querySelector('.audio-progress');
            progress.onclick = function(e) {
                const rect = progress.getBoundingClientRect();
                const percent = (e.clientX - rect.left) / rect.width;
                audio.currentTime = percent * audio.duration;
            };

            // éŸ³é‡æ§åˆ¶
            volumeControl.onclick = function(e) {
                const rect = volumeControl.getBoundingClientRect();
                const percent = (e.clientX - rect.left) / rect.width;
                audio.volume = Math.max(0, Math.min(1, percent));
                volumeLevel.style.width = (percent * 100) + '%';
            };

            // æ ¼å¼åŒ–æ—¶é—´
            function formatTime(seconds) {
                const minutes = Math.floor(seconds / 60);
                seconds = Math.floor(seconds % 60);
                return `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }

            // è‡ªåŠ¨æ’­æ”¾
            audio.play().catch(e => console.log('Auto-play prevented:', e));
        }

        // çª—å£å¤§å°æ”¹å˜æ—¶é‡ç»˜å›¾è¡¨
        window.addEventListener('resize', function() {
            if (myChart) {
                myChart.resize();
            }
        });

        // ç»‘å®šæŒ‰é’®äº‹ä»¶
        document.getElementById('analyzeBtn').addEventListener('click', analyzeSentiment);
        document.getElementById('generateTTS').addEventListener('click', generateTTS);

        // ä¿®æ”¹ç»“æœæ›´æ–°å‡½æ•°
        function updateResults(data) {
            const resultsContainer = document.getElementById('results');
            
            // æ ¹æ®æƒ…æ„Ÿé€‰æ‹©emojiå’Œé¢œè‰²
            let emotionEmoji = 'ğŸ˜';
            let emotionColor = '#607D8B';
            
            if (data.sentiment.includes('ç§¯æ') || data.sentiment.includes('æ­£é¢')) {
                emotionEmoji = 'ğŸ˜Š';
                emotionColor = '#4CAF50';
            } else if (data.sentiment.includes('æ¶ˆæ') || data.sentiment.includes('è´Ÿé¢')) {
                emotionEmoji = 'ğŸ˜”';
                emotionColor = '#f44336';
            }
            
            // åˆ›å»ºç»“æœHTML
            const resultHTML = `
                <div class="result-card animate-fade-in">
                    <div class="result-header">
                        <h3>   åˆ†æç»“æœ</h3>
                    </div>
                    <div class="result-content">
                        <div class="result-emotion">
                            <span class="large-emoji">${emotionEmoji}</span>
                        </div>
                        <div class="result-item">
                            <span class="label">æƒ…æ„Ÿå€¾å‘ï¼š</span>
                            <span class="value" style="color: ${emotionColor}">${data.sentiment}</span>
                        </div>
                        <div class="result-item">
                            <span class="label">ç½®ä¿¡åº¦ï¼š</span>
                            <span class="value">${(data.confidence * 100).toFixed(1)}%</span>
                        </div>
                        <div id="sentiment-chart" class="sentiment-chart"></div>
                    </div>
                </div>
            `;
            
            resultsContainer.innerHTML = resultHTML;
            
            // ç¡®ä¿ç­‰å¾…DOMæ›´æ–°åå†åˆå§‹åŒ–å›¾è¡¨
            setTimeout(() => {
                const chartContainer = document.querySelector('#sentiment-chart');
                if (chartContainer) {
                    // é‡æ–°åˆå§‹åŒ–å›¾è¡¨
                    if (myChart) {
                        myChart.dispose();  // é”€æ¯æ—§çš„å›¾è¡¨å®ä¾‹
                    }
                    myChart = echarts.init(chartContainer);
            
                    // å¤„ç†åµŒå¥—æ•°ç»„çš„æƒ…å†µ
                    let probArray = Array.isArray(data.probabilities[0]) ? 
                                  data.probabilities[0] : 
                                  data.probabilities;
            
                    // æ ¹æ®æƒ…æ„Ÿå€¾å‘å†³å®šæ ‡ç­¾
                    const isNegative = data.sentiment === 'æ¶ˆæ' || data.sentiment === 'è´Ÿé¢';
                    const accurateLabel = isNegative ? 'æ¶ˆæ' : 'ç§¯æ';
                    const inaccurateLabel = isNegative ? 'ç§¯æ' : 'æ¶ˆæ';
            
                    const option = {
                        title: {
                            text: 'æƒ…æ„Ÿæ¦‚ç‡åˆ†å¸ƒ',
                            left: 'center'
                        },
                        tooltip: {
                            trigger: 'item',
                            formatter: '{b}: {c}%'
                        },
                        legend: {
                            orient: 'horizontal',
                            bottom: 'bottom'
                        },
                        series: [
                            {
                                type: 'pie',
                                radius: '50%',
                                data: [
                                    { 
                                        value: (probArray[0] * 100).toFixed(1), 
                                        name: accurateLabel,
                                        itemStyle: { color: isNegative ? '#f44336' : '#4CAF50' }
                                    },
                                    { 
                                        value: (probArray[1] * 100).toFixed(1), 
                                        name: inaccurateLabel,
                                        itemStyle: { color: isNegative ? '#4CAF50' : '#f44336' }
                                    }
                                ],
                                emphasis: {
                                    itemStyle: {
                                        shadowBlur: 10,
                                        shadowOffsetX: 0,
                                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                                    }
                                }
                            }
                        ]
                    };
            
                    myChart.setOption(option);
                } else {
                    console.error('Chart container not found');
                }
            }, 100);

            // åœ¨åˆ†æå®Œæˆåè‡ªåŠ¨ç”Ÿæˆè¯­éŸ³
            generateTTS();
        }
    </script>
</body>
</html>